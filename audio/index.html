<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procedural Audio Noise Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #333;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .subtitle {
            color: #888;
            font-size: 0.9em;
        }

        .master-controls {
            background: #242424;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 0.85em;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group input[type="range"] {
            width: 150px;
        }

        .control-group .value-display {
            font-size: 0.9em;
            color: #4CAF50;
            font-weight: bold;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
        }

        button:hover {
            background: #45a049;
        }

        button:active {
            transform: scale(0.98);
        }

        .add-layer-btn {
            font-size: 1.2em;
            padding: 12px 30px;
        }

        .layers-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .layer {
            background: #242424;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            transition: border-color 0.3s;
        }

        .layer.active {
            border-color: #4CAF50;
        }

        .layer.inactive {
            opacity: 0.5;
        }

        .layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .layer-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #4CAF50;
        }

        .layer-header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toggle-btn {
            background: #555;
            padding: 5px 15px;
            font-size: 0.9em;
        }

        .toggle-btn.active {
            background: #4CAF50;
        }

        .delete-btn {
            background: #d32f2f;
            padding: 5px 15px;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #c62828;
        }

        .layer-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
        }

        select {
            width: 100%;
            padding: 8px;
            background: #333;
            color: #e0e0e0;
            border: 1px solid #444;
            border-radius: 4px;
            font-size: 0.9em;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h2 {
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .layer-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Procedural Audio Noise Generator</h1>
            <p class="subtitle">Real-time layered sound synthesis • Fully procedural • Always unique</p>
        </header>

        <div class="master-controls">
            <div class="control-group">
                <label>Master Volume</label>
                <input type="range" id="masterVolume" min="0" max="1" step="0.01" value="0.5">
                <span class="value-display" id="masterVolumeDisplay">50%</span>
            </div>
            <button class="add-layer-btn" id="addLayerBtn">+ Add Layer</button>
        </div>

        <div id="layersContainer" class="layers-container">
            <div class="empty-state">
                <h2>No layers yet</h2>
                <p>Click "+ Add Layer" to start creating your soundscape</p>
            </div>
        </div>
    </div>

    <script>
        // Audio Context and Master Controls
        let audioContext;
        let masterGain;
        let layers = [];
        let layerIdCounter = 0;

        // Initialize audio on user interaction
        document.getElementById('addLayerBtn').addEventListener('click', initAudio);
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioContext.createGain();
                masterGain.gain.value = 0.5;
                masterGain.connect(audioContext.destination);
                
                // Remove the init listener
                document.getElementById('addLayerBtn').removeEventListener('click', initAudio);
                document.getElementById('addLayerBtn').addEventListener('click', addLayer);
                
                // Add first layer automatically
                addLayer();
            }
        }

        // Master volume control
        document.getElementById('masterVolume').addEventListener('input', (e) => {
            if (masterGain) {
                masterGain.gain.value = parseFloat(e.target.value);
                document.getElementById('masterVolumeDisplay').textContent = 
                    Math.round(e.target.value * 100) + '%';
            }
        });

        // Noise generation functions
        class NoiseGenerator {
            constructor(context, type = 'brown') {
                this.context = context;
                this.type = type;
                this.bufferSize = 4096;
                this.node = null;
                this.lastOut = 0;
                this.createNode();
            }

            createNode() {
                this.node = this.context.createScriptProcessor(this.bufferSize, 1, 1);
                
                this.node.onaudioprocess = (e) => {
                    const output = e.outputBuffer.getChannelData(0);
                    
                    if (this.type === 'white') {
                        for (let i = 0; i < this.bufferSize; i++) {
                            output[i] = Math.random() * 2 - 1;
                        }
                    } else if (this.type === 'brown') {
                        for (let i = 0; i < this.bufferSize; i++) {
                            const white = Math.random() * 2 - 1;
                            output[i] = (this.lastOut + (0.02 * white)) / 1.02;
                            this.lastOut = output[i];
                            output[i] *= 3.5; // Compensate volume
                        }
                    } else if (this.type === 'pink') {
                        let b0 = 0, b1 = 0, b2 = 0, b3 = 0, b4 = 0, b5 = 0, b6 = 0;
                        for (let i = 0; i < this.bufferSize; i++) {
                            const white = Math.random() * 2 - 1;
                            b0 = 0.99886 * b0 + white * 0.0555179;
                            b1 = 0.99332 * b1 + white * 0.0750759;
                            b2 = 0.96900 * b2 + white * 0.1538520;
                            b3 = 0.86650 * b3 + white * 0.3104856;
                            b4 = 0.55000 * b4 + white * 0.5329522;
                            b5 = -0.7616 * b5 - white * 0.0168980;
                            output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                            output[i] *= 0.11;
                            b6 = white * 0.115926;
                        }
                    }
                };
            }

            connect(destination) {
                this.node.connect(destination);
            }

            disconnect() {
                this.node.disconnect();
            }
        }

        // Layer class
        class Layer {
            constructor(id) {
                this.id = id;
                this.active = true;
                this.sourceType = 'brown';
                
                // Audio nodes
                this.source = null;
                this.gain = audioContext.createGain();
                this.lowpass = audioContext.createBiquadFilter();
                this.highpass = audioContext.createBiquadFilter();
                this.distortion = audioContext.createWaveShaper();
                this.panner = audioContext.createStereoPanner();
                this.lfoGain = audioContext.createGain();
                this.lfo = audioContext.createOscillator();
                
                // Setup filters
                this.lowpass.type = 'lowpass';
                this.lowpass.frequency.value = 20000;
                this.lowpass.Q.value = 0.5;
                
                this.highpass.type = 'highpass';
                this.highpass.frequency.value = 20;
                this.highpass.Q.value = 0.5;
                
                // Setup distortion
                this.distortion.curve = this.makeDistortionCurve(0);
                
                // Setup LFO
                this.lfo.frequency.value = 0;
                this.lfoGain.gain.value = 0;
                this.lfo.connect(this.lfoGain);
                this.lfo.start();
                
                // Initial gain
                this.gain.gain.value = 0.3;
                
                // Connect audio graph
                this.createSource();
                this.connectNodes();
            }

            createSource() {
                if (this.source) {
                    this.source.disconnect();
                }

                if (this.sourceType === 'white' || this.sourceType === 'brown' || this.sourceType === 'pink') {
                    this.source = new NoiseGenerator(audioContext, this.sourceType);
                } else {
                    // Oscillator types
                    this.source = audioContext.createOscillator();
                    this.source.type = this.sourceType;
                    this.source.frequency.value = 220;
                    this.source.start();
                }
            }

            connectNodes() {
                // Audio path: source -> highpass -> lowpass -> distortion -> gain -> panner -> master
                this.source.connect(this.highpass);
                this.highpass.connect(this.lowpass);
                this.lowpass.connect(this.distortion);
                this.distortion.connect(this.gain);
                this.gain.connect(this.panner);
                
                if (this.active) {
                    this.panner.connect(masterGain);
                }
            }

            setSourceType(type) {
                this.sourceType = type;
                this.createSource();
                this.connectNodes();
            }

            setActive(active) {
                this.active = active;
                if (active) {
                    this.panner.connect(masterGain);
                } else {
                    this.panner.disconnect();
                }
            }

            setVolume(value) {
                this.gain.gain.value = value;
            }

            setLowpass(freq) {
                this.lowpass.frequency.value = freq;
            }

            setHighpass(freq) {
                this.highpass.frequency.value = freq;
            }

            setLowpassQ(q) {
                this.lowpass.Q.value = q;
            }

            setHighpassQ(q) {
                this.highpass.Q.value = q;
            }

            setDistortion(amount) {
                this.distortion.curve = this.makeDistortionCurve(amount);
            }

            setPan(value) {
                this.panner.pan.value = value;
            }

            setLFORate(rate) {
                this.lfo.frequency.value = rate;
            }

            setLFODepth(depth) {
                this.lfoGain.gain.value = depth;
                // Disconnect and reconnect LFO
                this.lfoGain.disconnect();
                if (depth > 0) {
                    this.lfoGain.connect(this.lowpass.frequency);
                }
            }

            setFrequency(freq) {
                if (this.source && this.source.frequency) {
                    this.source.frequency.value = freq;
                }
            }

            makeDistortionCurve(amount) {
                const samples = 44100;
                const curve = new Float32Array(samples);
                const deg = Math.PI / 180;
                
                for (let i = 0; i < samples; i++) {
                    const x = (i * 2) / samples - 1;
                    curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));
                }
                
                return curve;
            }

            destroy() {
                if (this.source) {
                    if (this.source.stop) {
                        this.source.stop();
                    }
                    this.source.disconnect();
                }
                this.lfo.stop();
                this.lfo.disconnect();
                this.gain.disconnect();
                this.lowpass.disconnect();
                this.highpass.disconnect();
                this.distortion.disconnect();
                this.panner.disconnect();
            }
        }

        // UI Functions
        function addLayer() {
            const layer = new Layer(layerIdCounter++);
            layers.push(layer);
            renderLayers();
        }

        function removeLayer(id) {
            const index = layers.findIndex(l => l.id === id);
            if (index !== -1) {
                layers[index].destroy();
                layers.splice(index, 1);
                renderLayers();
            }
        }

        function toggleLayer(id) {
            const layer = layers.find(l => l.id === id);
            if (layer) {
                layer.setActive(!layer.active);
                renderLayers();
            }
        }

        function renderLayers() {
            const container = document.getElementById('layersContainer');
            
            if (layers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>No layers yet</h2>
                        <p>Click "+ Add Layer" to start creating your soundscape</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = layers.map(layer => `
                <div class="layer ${layer.active ? 'active' : 'inactive'}" data-id="${layer.id}">
                    <div class="layer-header">
                        <span class="layer-title">Layer ${layer.id + 1}</span>
                        <div class="layer-header-controls">
                            <button class="toggle-btn ${layer.active ? 'active' : ''}" 
                                    onclick="toggleLayer(${layer.id})">
                                ${layer.active ? 'ON' : 'OFF'}
                            </button>
                            <button class="delete-btn" onclick="removeLayer(${layer.id})">Delete</button>
                        </div>
                    </div>
                    <div class="layer-controls">
                        <div class="control-group">
                            <label>Source Type</label>
                            <select onchange="updateLayerSourceType(${layer.id}, this.value)">
                                <option value="brown" ${layer.sourceType === 'brown' ? 'selected' : ''}>Brown Noise</option>
                                <option value="white" ${layer.sourceType === 'white' ? 'selected' : ''}>White Noise</option>
                                <option value="pink" ${layer.sourceType === 'pink' ? 'selected' : ''}>Pink Noise</option>
                                <option value="sine" ${layer.sourceType === 'sine' ? 'selected' : ''}>Sine Wave</option>
                                <option value="triangle" ${layer.sourceType === 'triangle' ? 'selected' : ''}>Triangle Wave</option>
                                <option value="square" ${layer.sourceType === 'square' ? 'selected' : ''}>Square Wave</option>
                                <option value="sawtooth" ${layer.sourceType === 'sawtooth' ? 'selected' : ''}>Sawtooth Wave</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label>Volume</label>
                            <input type="range" min="0" max="1" step="0.01" value="${layer.gain.gain.value}"
                                   oninput="updateLayerParam(${layer.id}, 'volume', this.value, this)">
                            <span class="value-display">${Math.round(layer.gain.gain.value * 100)}%</span>
                        </div>

                        ${layer.sourceType === 'sine' || layer.sourceType === 'triangle' || 
                          layer.sourceType === 'square' || layer.sourceType === 'sawtooth' ? `
                        <div class="control-group">
                            <label>Frequency</label>
                            <input type="range" min="20" max="2000" step="1" value="220"
                                   oninput="updateLayerParam(${layer.id}, 'frequency', this.value, this)">
                            <span class="value-display">220 Hz</span>
                        </div>
                        ` : ''}
                        
                        <div class="control-group">
                            <label>Low-Pass Filter</label>
                            <input type="range" min="100" max="20000" step="10" value="${layer.lowpass.frequency.value}"
                                   oninput="updateLayerParam(${layer.id}, 'lowpass', this.value, this)">
                            <span class="value-display">${Math.round(layer.lowpass.frequency.value)} Hz</span>
                        </div>
                        
                        <div class="control-group">
                            <label>High-Pass Filter</label>
                            <input type="range" min="20" max="5000" step="10" value="${layer.highpass.frequency.value}"
                                   oninput="updateLayerParam(${layer.id}, 'highpass', this.value, this)">
                            <span class="value-display">${Math.round(layer.highpass.frequency.value)} Hz</span>
                        </div>
                        
                        <div class="control-group">
                            <label>Low-Pass Resonance</label>
                            <input type="range" min="0.1" max="20" step="0.1" value="${layer.lowpass.Q.value}"
                                   oninput="updateLayerParam(${layer.id}, 'lowpassQ', this.value, this)">
                            <span class="value-display">${layer.lowpass.Q.value.toFixed(1)}</span>
                        </div>
                        
                        <div class="control-group">
                            <label>High-Pass Resonance</label>
                            <input type="range" min="0.1" max="20" step="0.1" value="${layer.highpass.Q.value}"
                                   oninput="updateLayerParam(${layer.id}, 'highpassQ', this.value, this)">
                            <span class="value-display">${layer.highpass.Q.value.toFixed(1)}</span>
                        </div>
                        
                        <div class="control-group">
                            <label>Distortion</label>
                            <input type="range" min="0" max="100" step="1" value="0"
                                   oninput="updateLayerParam(${layer.id}, 'distortion', this.value, this)">
                            <span class="value-display">0</span>
                        </div>
                        
                        <div class="control-group">
                            <label>Pan</label>
                            <input type="range" min="-1" max="1" step="0.01" value="0"
                                   oninput="updateLayerParam(${layer.id}, 'pan', this.value, this)">
                            <span class="value-display">Center</span>
                        </div>
                        
                        <div class="control-group">
                            <label>LFO Rate</label>
                            <input type="range" min="0" max="10" step="0.1" value="0"
                                   oninput="updateLayerParam(${layer.id}, 'lfoRate', this.value, this)">
                            <span class="value-display">0.0 Hz</span>
                        </div>
                        
                        <div class="control-group">
                            <label>LFO Depth</label>
                            <input type="range" min="0" max="5000" step="10" value="0"
                                   oninput="updateLayerParam(${layer.id}, 'lfoDepth', this.value, this)">
                            <span class="value-display">0 Hz</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateLayerSourceType(id, type) {
            const layer = layers.find(l => l.id === id);
            if (layer) {
                layer.setSourceType(type);
                renderLayers();
            }
        }

        function updateLayerParam(id, param, value, element) {
            const layer = layers.find(l => l.id === id);
            if (!layer) return;

            const numValue = parseFloat(value);
            const display = element.parentElement.querySelector('.value-display');

            switch(param) {
                case 'volume':
                    layer.setVolume(numValue);
                    display.textContent = Math.round(numValue * 100) + '%';
                    break;
                case 'lowpass':
                    layer.setLowpass(numValue);
                    display.textContent = Math.round(numValue) + ' Hz';
                    break;
                case 'highpass':
                    layer.setHighpass(numValue);
                    display.textContent = Math.round(numValue) + ' Hz';
                    break;
                case 'lowpassQ':
                    layer.setLowpassQ(numValue);
                    display.textContent = numValue.toFixed(1);
                    break;
                case 'highpassQ':
                    layer.setHighpassQ(numValue);
                    display.textContent = numValue.toFixed(1);
                    break;
                case 'distortion':
                    layer.setDistortion(numValue);
                    display.textContent = Math.round(numValue);
                    break;
                case 'pan':
                    layer.setPan(numValue);
                    if (numValue < -0.1) display.textContent = 'Left ' + Math.abs(Math.round(numValue * 100));
                    else if (numValue > 0.1) display.textContent = 'Right ' + Math.round(numValue * 100);
                    else display.textContent = 'Center';
                    break;
                case 'lfoRate':
                    layer.setLFORate(numValue);
                    display.textContent = numValue.toFixed(1) + ' Hz';
                    break;
                case 'lfoDepth':
                    layer.setLFODepth(numValue);
                    display.textContent = Math.round(numValue) + ' Hz';
                    break;
                case 'frequency':
                    layer.setFrequency(numValue);
                    display.textContent = Math.round(numValue) + ' Hz';
                    break;
            }
        }
    </script>
</body>
</html>
