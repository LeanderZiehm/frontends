<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Custom Shortcut Executor</title>
<style>
  body { font-family: sans-serif; margin: 2rem; }
  label { display: block; margin-top: 1rem; }
  textarea { width: 100%; height: 150px; }
  input[type=text] { width: 200px; }
  .shortcut-display { margin-top: 0.5rem; font-weight: bold; color: #007acc; }
  button { margin-top: 1rem; }
</style>
</head>
<body>
<h2>Custom JS Shortcuts</h2>

<label>JavaScript code:
  <textarea id="jsCode">// Write your JS here</textarea>
</label>

<label>Shortcut (focus this input and press keys):
  <input type="text" id="shortcutInput" placeholder="Click and press keys" readonly>
  <div class="shortcut-display" id="currentShortcut">No shortcut set</div>
</label>

<button id="saveBtn">Save Shortcut</button>

<script>
let currentShortcut = null;
let shortcutCodeMap = {};

const shortcutInput = document.getElementById('shortcutInput');
const currentShortcutDisplay = document.getElementById('currentShortcut');
const jsCode = document.getElementById('jsCode');
const saveBtn = document.getElementById('saveBtn');

function formatShortcut(event) {
  let keys = [];
  if (event.ctrlKey) keys.push('Ctrl');
  if (event.shiftKey) keys.push('Shift');
  if (event.altKey) keys.push('Alt');
  if (event.metaKey) keys.push('Meta');
  // Only add key if it's not a modifier
  const key = event.key.length === 1 ? event.key.toUpperCase() : event.key;
  if (!['Control','Shift','Alt','Meta'].includes(key)) keys.push(key);
  return keys.join('+');
}

// Record shortcut when user focuses input
shortcutInput.addEventListener('keydown', (e) => {
  e.preventDefault();
  currentShortcut = formatShortcut(e);
  shortcutInput.value = currentShortcut;
  currentShortcutDisplay.textContent = 'Current shortcut: ' + currentShortcut;
});

// Save the JS code with the shortcut
saveBtn.addEventListener('click', () => {
  if (!currentShortcut) {
    alert('Set a shortcut first!');
    return;
  }
  try {
    // test if JS parses
    new Function(jsCode.value);
    shortcutCodeMap[currentShortcut] = jsCode.value;
    alert(`Shortcut ${currentShortcut} saved!`);
  } catch(err) {
    alert('Error in JS code: ' + err);
  }
});

// Listen globally for shortcut execution
document.addEventListener('keydown', (e) => {
  const pressed = formatShortcut(e);
  if (shortcutCodeMap[pressed]) {
    e.preventDefault();
    try {
      new Function(shortcutCodeMap[pressed])();
    } catch(err) {
      console.error('Error executing shortcut code:', err);
      alert('Error executing JS: ' + err);
    }
  }
});
</script>
</body>
</html>
